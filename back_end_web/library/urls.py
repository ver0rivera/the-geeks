from django.urls import include, path
from django.views.decorators.csrf import csrf_exempt

from library.forms import MaterialUploadForm
from library.views.material_views import MaterialUploadFormView

from .views import (CommentFormView, ContactTemplateView, CourseDetailView,
                    CourseListView, ExerciseListView, GenericResourceListView,
                    MaterialDetailView, MaterialListView, SemesterListView,
                    index_view)

"""
The following patterns are used to define the urls 
of the library app. Note that the url patterns are 
defined in a list of lists, where each list represents
a group of urls that share a common prefix. 

In this case materials, resources and exercises are 
grouped together inside the materials_types_patterns list, 
followed by the course_patterns list, followed by the 
semester_patterns list and finally the urlpatterns list.

A final example of the url patterns generated by this file is:
    /semesters/1/courses/discret-mats/unit/1/materials/1
"""

material_patterns = [
    path("", MaterialListView.as_view(), name="material_list"),
    path("<int:material_id>",
         MaterialDetailView.as_view(),
         name="material_detail"),
]

resource_patterns = [
    path("", GenericResourceListView.as_view(), name="resource_list"),
    path("<int:material_id>",
         MaterialDetailView.as_view(),
         name="resource_detail"),
]

exercise_patterns = [
    path("", ExerciseListView.as_view(), name="excercise_list"),
    path("<int:material_id>/",
         MaterialDetailView.as_view(),
         name="exercise_detail")
]

materials_types_patterns = [
    path("materials/", include(material_patterns)),
    path("resources/", include(resource_patterns)),
    path("exercises/", include(exercise_patterns)),
]

course_patterns = [
    path("", CourseListView.as_view(), name="course_list"),
    path("<slug:slug>/", CourseDetailView.as_view(), name="course_detail"),
    path("<slug:slug>/unit/<int:unit_num>/",
         include(materials_types_patterns)),
]

semester_patterns = [
    path("", SemesterListView.as_view(), name="semester_list"),
    path("<int:semester_num>/courses/", include(course_patterns)),
]

urlpatterns = [
    path("", index_view, name="home"),
    path("courses/",
         csrf_exempt(CourseListView.as_view()),
         name="course_search_results"),
    path("comments/", CommentFormView.as_view(), name="comment_form"),
    path("contact/", ContactTemplateView.as_view(), name="contact"),
    path("semesters/", include(semester_patterns)),
    path("upload/", MaterialUploadFormView.as_view(), name="upload"),
]
